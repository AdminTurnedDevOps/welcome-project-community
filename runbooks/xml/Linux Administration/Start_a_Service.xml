<joblist>
  <job>
    <context>
      <options preserveOrder='true'>
        <option enforcedvalues='true' name='service' required='true' value='nginx' values='mysql,nginx' valuesListDelimiter=','>
          <label>Linux Service</label>
        </option>
      </options>
    </context>
    <defaultTab>output</defaultTab>
    <description>Check a Linux service status and start if it's down.</description>
    <dispatch>
      <excludePrecedence>false</excludePrecedence>
      <keepgoing>true</keepgoing>
      <rankOrder>ascending</rankOrder>
      <successOnEmptyNodeFilter>false</successOnEmptyNodeFilter>
      <threadcount>1</threadcount>
    </dispatch>
    <executionEnabled>true</executionEnabled>
    <group>Administration/Linux</group>
    <id>acc2844d-28be-4cf4-9420-ca9b139ee537</id>
    <loglevel>INFO</loglevel>
    <name>Start a Service</name>
    <nodeFilterEditable>true</nodeFilterEditable>
    <nodefilters>
      <filter>name: node00</filter>
    </nodefilters>
    <nodesSelectedByDefault>true</nodesSelectedByDefault>
    <plugins />
    <scheduleEnabled>false</scheduleEnabled>
    <sequence keepgoing='true' strategy='node-first'>
      <command>
        <description>Get the service status from systemd</description>
        <exec>systemctl status ${option.service} | grep "Active" | awk  '''{print $2}''' | cat</exec>
        <plugins>
          <LogFilter type='key-value-data'>
            <config>
              <invalidKeyPattern>\s|\$|\{|\}|\\</invalidKeyPattern>
              <logData>true</logData>
              <name>status</name>
              <regex>(.*)</regex>
            </config>
          </LogFilter>
        </plugins>
      </command>
      <command>
        <description>Now, if the status is "inactive" then restart the service</description>
        <fileExtension>.sh</fileExtension>
        <script><![CDATA[# print the service status
echo "current status is @data.status@"

# start the service if the stauts is "inactive"
if [ @data.status@ = 'inactive' ]; then
    echo "starting @option.service@..."
	sudo systemctl start @option.service@
else
    echo "System is active, nothing to do."
    sudo systemctl status @option.service@ | cat
fi

# All done.
echo "done"]]></script>
        <scriptargs />
        <scriptinterpreter>/bin/bash</scriptinterpreter>
      </command>
    </sequence>
    <uuid>acc2844d-28be-4cf4-9420-ca9b139ee537</uuid>
  </job>
</joblist>