- defaultTab: output
  description: Check a Linux service status and stop if it's up.
  executionEnabled: true
  group: Administration/Linux
  id: 3448b21a-b287-453d-9b2d-bd1cf7d100e5
  loglevel: INFO
  name: Stop a Service
  nodeFilterEditable: true
  nodefilters:
    dispatch:
      excludePrecedence: true
      keepgoing: true
      rankOrder: ascending
      successOnEmptyNodeFilter: false
      threadcount: '1'
    filter: 'name: node00'
  nodesSelectedByDefault: true
  options:
  - enforced: true
    label: Linux service
    name: service
    required: true
    value: nginx
    values:
    - mysql
    - nginx
    valuesListDelimiter: ','
  plugins:
    ExecutionLifecycle: null
  scheduleEnabled: false
  sequence:
    commands:
    - description: Get the service status from systemd
      exec: systemctl status ${option.service} | grep "Active" | awk  '''{print $2}'''
        | cat
      plugins:
        LogFilter:
        - config:
            invalidKeyPattern: \s|\$|\{|\}|\\
            logData: 'true'
            name: status
            regex: (.*)
          type: key-value-data
    - description: 'Now, if the status is "inactive" then stop the service'
      fileExtension: .sh
      interpreterArgsQuoted: false
      script: "# print the service status\necho \"current status is @data.status@\"\
        \n\n# start the service if the stauts is \"inactive\"\nif [ @data.status@\
        \ = 'active' ]; then\n    echo \"stopping @option.service@...\"\n\tsudo systemctl\
        \ stop @option.service@\nelse\n    echo \"System is inactive, nothing to do.\"\
        \n    sudo systemctl status @option.service@ | cat\nfi\n\n# all done.\necho\
        \ \"Done.\""
      scriptInterpreter: /bin/bash
    keepgoing: true
    strategy: node-first
  uuid: 3448b21a-b287-453d-9b2d-bd1cf7d100e5
